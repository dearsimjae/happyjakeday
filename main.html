<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Happy Birthday Jaeyun ğŸ‚â„ï¸</title>
  <style>
    .container {
  width: 80%;   /* å å±å¹•å®½åº¦çš„80% */
  max-width: 1200px; /* å¤§å±æ—¶æœ€å¤š1200px */
  font-size: 2vw; /* æ ¹æ®å±å¹•å®½åº¦è°ƒæ•´æ–‡å­—å¤§å° */
}

  .container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
    button {
  padding: 20px 40px;  /* desktop size */
  font-size: 20px;
}

@media (max-width: 600px) {
  button {
    padding: 10px 20px;  /* smaller on phone */
    font-size: 14px;
  }
}



        body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
        background: url("assets/background.jpg") no-repeat center center/cover;
        }

     /* èƒŒæ™¯å›¾ */
    #background {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    /* å°ç”·å­© & ä¿¡ç®± */
    #boy {
      position: absolute;
      bottom: 150px;
      left: 46%;
      transform: translateX(-60%) scale(0.6);
      cursor: pointer;
      z-index: 5;
      pointer-events: none;
    }
    #mailbox {
      position: absolute;
      bottom: 200px;
      left: 46%;
      transform: translateX(20%) scale(0.6);
      cursor: pointer;
      z-index: 5;
    }

    /* ç¥ç¦é›ªèŠ±ï¼ˆæ–‡å­— + èƒŒæ™¯é›ªèŠ±å›¾ï¼‰*/
    .snowflake {
      position: absolute;
      top: -120px;
      left: 0;
      width: 50px;
      height: 50px;
      background: url("assets/snowflake.png") no-repeat center/contain;
      background-size: contain;
      display: flex;
      flex-shrink: 0;   /* é˜²æ­¢å› ä¸ºæ–‡å­—æ’‘å¤§ */
        overflow: hidden; /* è¶…å‡ºéƒ¨åˆ†éšè— */
      align-items: center;
      justify-content: center;
      pointer-events: none;
      z-index: 20;
      white-space: nowrap;
      font-size: 9px;
      color: #9db1c4;
      text-shadow: 0 0 8px rgba(250,218,228,0.8);
      transform-origin: center;
    }

    /* å°é›ªèŠ±å›¾ç‰‡è£…é¥° */
    .miniSnow {
      position: absolute;
      top: -40px;
      width: 50px;
      height: 50px;
      pointer-events:none;
      z-index: 15;
      opacity: 1;
      background-size: contain;
    }

    /* é¡¶éƒ¨æç¤ºï¼ˆå¯åˆ ï¼‰ */
    #hint {
      position:absolute;
      top:12px; left:50%;
      transform:translateX(-50%);
      z-index:40;
      color:#fff;
      background: rgba(0,0,0,0.25);
      padding:6px 10px; border-radius:8px; font-size:13px;
    }

    /* ç®€å•å“åº”å¼ï¼šå±å¹•çª„æ—¶ç¼©å°é›ªèŠ± */
    @media (max-width:420px) {
      .snowflake { width:86px; height:86px; font-size:11px; }
    }
    body {
  background: url("bg-desktop.jpg") no-repeat center center/cover;
}

@media (max-width: 768px) {
  body {
    background: url("bg-mobile.jpg") no-repeat center center/cover;
  }
}
/* æ‰‹æœº */
@media (max-width: 600px) {
  body {
    font-size: 9px;
  }
}

/* å¹³æ¿ */
@media (min-width: 601px) and (max-width: 1024px) {
  body {
    font-size: 11px;
  }
}

/* æ¡Œé¢ */
@media (min-width: 1025px) {
  body {
    font-size: 12px;
  }
}

  </style>
</head>
<body>

  <div id="hint">ç‚¹ä¿¡ç®±å†™ä¸‹ä½ çš„ç¥ç¦ç»™æ²ˆè½½ä¼¦ Click Mailbox To Write Down Your Message To Jake!  âœ‰ï¸</div>

  <!-- å›¾ç‰‡èµ„æºï¼ˆæ”¾åˆ° assets/ ï¼‰ -->
  <img id="background" src="assets/bg-desktop.jpg" alt="background">
  <img id="boy" src="assets/boy.png" alt="boy">
  <img id="mailbox" src="assets/mailbox.png" alt="mailbox">

  <!-- æ‰€æœ‰é€»è¾‘æ”¾åœ¨ module è„šæœ¬æœ€åï¼ˆç¡®ä¿ DOM å·²å°±ç»ªï¼‰ -->
  <script type="module">
    // --------- æŠŠä¸‹é¢ firebaseConfig æ¢æˆä½ è‡ªå·±çš„ ---------
    const firebaseConfig = {
  apiKey: "AIzaSyCYWBXPW6ubnowyxn6SAoVIZQzXZ0yKqgk",
  authDomain: "jaeyun-bday.firebaseapp.com",
  databaseURL: "https://jaeyun-bday-default-rtdb.firebaseio.com",
  projectId: "jaeyun-bday",
  storageBucket: "jaeyun-bday.firebasestorage.app",
  messagingSenderId: "243627514944",
  appId: "1:243627514944:web:2603347b229c547d4453a5",
  measurementId: "G-VWBZMQXH4L"
}
    // ---------------------------------------------------------

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import {
      getFirestore, collection, addDoc,
      query, orderBy, limit, onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    // init firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const wishesCol = collection(db, "wishes");

    // DOM å…ƒç´ 
    const mailbox = document.getElementById("mailbox");

    // é˜²é‡å¤ï¼šè®°å½•æœ¬å®¢æˆ·ç«¯åˆšå†™å…¥çš„ docIdï¼ˆonSnapshot æ–°å¢æ—¶è·³è¿‡ï¼‰
    const recentlyOwn = new Set();

    // é»˜è®¤ç¥ç¦ï¼ˆé¡µé¢æ‰“å¼€æ—¶ä»…æœ¬åœ°ç”Ÿæˆï¼Œä¸å†™å…¥æ•°æ®åº“ï¼‰
    const defaultWishes = [
      "ç”Ÿæ—¥å¿«ä¹ ğŸ‚",
      "ìƒì¼ì¶•í•˜í•´!",
      "my lucky-yun"
    ];

    // åˆ›å»ºæ–‡å­—é›ªèŠ±ï¼ˆæ°¸è¿œå¾ªç¯ä¸‹è½ï¼‰
    function createSnowflake(text) {
      const el = document.createElement("div");
      el.className = "snowflake";
      el.textContent = "â„ " + text + " â„";

      // éšæœºå­—ä½“å¤§å° & å¾®å°æ—‹è½¬
      const scale = 0.9 + Math.random() * 0.7;
      el.style.transform = `scale(${scale}) rotate(${(Math.random()-0.5)*10}deg)`;

      // æ°´å¹³ä½ç½®ï¼ˆé¿å¼€ç”»é¢æœ€å³è¾¹ä¸€ç‚¹ï¼‰
      const maxLeft = Math.max(window.innerWidth - 120, 50);
      el.style.left = Math.random() * maxLeft + "px";
      el.style.top = (-30 - Math.random()*300) + "px"; // ä»æ›´ä¸Šæ–¹å¼€å§‹

      document.body.appendChild(el);

      // ä¸‹è½é€»è¾‘ï¼ˆrequestAnimationFrameï¼‰
      let y = parseFloat(el.style.top);
      const speed = 0.6 + Math.random() * 1.8;

      function fall() {
        y += speed;
        if (y > window.innerHeight + 40) {
          // åˆ°åº•åç«‹åˆ»å›åˆ°é¡¶éƒ¨å¹¶åˆ‡æ¢éšæœºæ°´å¹³ä½ç½®
          y = -40 - Math.random() * 140;
          el.style.left = Math.random() * maxLeft + "px";
        }
        el.style.top = y + "px";
        requestAnimationFrame(fall);
      }
      requestAnimationFrame(fall);
    }

    // åˆ›å»ºè¿·ä½ é›ªèŠ±å›¾ç‰‡è£…é¥°ï¼ˆæŒç»­å¾ªç¯ï¼‰
    function createMiniSnow(size=null, left=null, speed=null) {
      const img = document.createElement("img");
      img.src = "assets/snowflake.png"; // ä½ çš„å°é›ªèŠ±å›¾ï¼ˆé€æ˜èƒŒæ™¯æœ€å¥½ï¼‰
      img.className = "miniSnow";
      const s = size || (12 + Math.random() * 20);
      img.style.width = s + "px";
      img.style.height = s + "px";
      const L = (left !== null) ? left : Math.random() * Math.max(window.innerWidth - s, 10);
      img.style.left = L + "px";
      img.style.top = (-10 - Math.random() * 200) + "px";
      document.body.appendChild(img);

      let y = parseFloat(img.style.top);
      const spd = speed || (0.3 + Math.random() * 1.3);

      function fall() {
        y += spd;
        if (y > window.innerHeight + 20) {
          y = -20 - Math.random() * 80;
          img.style.left = Math.random() * Math.max(window.innerWidth - s, 10) + "px";
        }
        img.style.top = y + "px";
        requestAnimationFrame(fall);
      }
      requestAnimationFrame(fall);
    }

    // ç‚¹å‡»ä¿¡ç®±ï¼šå¼¹ promptï¼ˆä½ ä¹Ÿå¯ä»¥æ¢æˆå¼¹çª—ï¼‰ï¼Œå¹¶æŠŠç¥ç¦å†™å…¥ Firestore
    async function openWishBox() {
      const message = prompt("å†™ä¸‹ä½ ç»™æ²ˆè½½ä¼¦çš„ç”Ÿæ—¥ç¥ç¦å§ Write down wishes to jakeğŸ’Œ");
      if (!message) return;

      try {
        // å†™å…¥ Firestore
        const docRef = await addDoc(wishesCol, { message: message.trim(), createdAt: Date.now() });
        // è®°å½•æœ¬å®¢æˆ·ç«¯åˆšå†™å…¥çš„ idï¼ŒçŸ­æ—¶é—´å†… onSnapshot çš„ added å°†è¢«å¿½ç•¥ï¼ˆé¿å…é‡å¤ç”Ÿæˆï¼‰
        recentlyOwn.add(docRef.id);
        setTimeout(() => recentlyOwn.delete(docRef.id), 4000);

        // æœ¬åœ°ç«‹å³ç”Ÿæˆè§†è§‰åé¦ˆï¼ˆæ•°æ®åº“ç›‘å¬ä¹Ÿä¼šè§¦å‘ï¼Œä½†ä¼šè¢«ä¸Šé¢å»é‡æŒ¡æ‰ï¼‰
        createSnowflake(message.trim());
      } catch (err) {
        console.error("ä¿å­˜ç¥ç¦å¤±è´¥ï¼š", err);
        alert("æäº¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚");
      }
    }

    // ç»‘å®šç‚¹å‡»
    mailbox.addEventListener("click", openWishBox);

    // å®æ—¶ç›‘å¬æ•°æ®åº“ï¼ˆå–æœ€è¿‘ 500 æ¡ï¼ŒæŒ‰æ—¶é—´å‡åºï¼‰
    const q = query(wishesCol, orderBy("createdAt", "asc"), limit(500));
    onSnapshot(q, (snapshot) => {
      snapshot.docChanges().forEach((change) => {
        if (change.type === "added") {
          const id = change.doc.id;
          const data = change.doc.data();
          // å¦‚æœæ˜¯åˆšåˆšè‡ªå·±å†™å…¥çš„ï¼ˆrecentlyOwnï¼‰ï¼Œè·³è¿‡ï¼ˆé¿å…åŒé‡ï¼‰
          if (recentlyOwn.has(id)) {
            recentlyOwn.delete(id);
            return;
          }
          if (data && data.message) {
            createSnowflake(data.message);
          }
        }
      });
    });

    // é¡µé¢åŠ è½½ï¼šç”Ÿæˆè‹¥å¹²è¿·ä½ é›ªèŠ± & é»˜è®¤ç¥ç¦ï¼ˆä»…å‰ç«¯å±•ç¤ºï¼‰
    window.addEventListener("load", () => {
      for (let i = 0; i < 25; i++) createMiniSnow();
      // é¡µé¢æ‰“å¼€æ—¶ç»™ç‚¹é»˜è®¤ç¥ç¦ï¼ˆåªæ˜¯è§†è§‰ï¼Œä¸å­˜æ•°æ®åº“ï¼‰
      defaultWishes.forEach((w, i) => setTimeout(()=> createSnowflake(w), 300 + i*450));
    });

    // å…¼å®¹ï¼šçª—å£å¤§å°å˜æ›´æ—¶ï¼ˆå¯é€‰ï¼‰â€”â€”è¿™é‡Œä¸é”€æ¯å·²æœ‰é›ªèŠ±ï¼Œä»…ä¿è¯åç»­ä½ç½®åˆç†
    window.addEventListener("resize", () => {
      // noop for now
    });

  </script>
</body>
</html>
